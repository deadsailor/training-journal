<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–¢—Ä–µ–Ω—É–≤–∞–ª—å–Ω–∏–π –©–æ–¥–µ–Ω–Ω–∏–∫</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; }
    h1 { color: #333; }
    select, input, textarea, button {
      font-size: 16px; margin: 5px 0; padding: 8px; width: 100%; }
    input[type="date"] { padding: 6px; }
    .exercise-block { background: #fff; padding: 10px; border-radius: 8px; margin-bottom: 15px; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
    .exercise-block[draggable="true"] { cursor: move; }
    .label { font-weight: bold; margin-top: 10px; }
    .color-buttons button {
      width: 30px; height: 30px; border: none; border-radius: 50%; margin: 0 3px; cursor: pointer;
    }
    .green { background: #6fcf97; }
    .orange { background: #ffe066; }
    .red { background: #eb5757; }
    .set-row { display: flex; gap: 10px; align-items: center; margin-bottom: 5px; }
    .set-row input[type="number"] { width: 30%; }
    .set-row .intensity-buttons { display: flex; gap: 5px; }
  </style>
</head>
<body>
  <h1>–¢—Ä–µ–Ω—É–≤–∞–ª—å–Ω–∏–π –©–æ–¥–µ–Ω–Ω–∏–∫</h1>

  <label for="training-date">–î–∞—Ç–∞ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è:</label>
  <input type="date" id="training-date" onchange="loadDayFromDate()" />

  <label for="training-day">–î–µ–Ω—å —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è:</label>
  <select id="training-day" onchange="renderExercises()">
    <option value="DAY1">DAY1</option>
    <option value="DAY2">DAY2</option>
    <option value="DAY3">DAY3</option>
    <option value="DAY4">DAY4</option>
  </select>

  <label for="custom-exercises">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –≤–ø—Ä–∞–≤–∏ (—á–µ—Ä–µ–∑ –∫–æ–º—É):</label>
  <input type="text" id="custom-exercises" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –ü—Ä–∏—Å—ñ–¥–∞–Ω–Ω—è, –í–∏–ø–∞–¥–∏, –ü—É–ª–ª–æ–≤–µ—Ä" onchange="updateCustomExercises()" />

  <div id="exercises" ondragover="event.preventDefault()"></div>

  <button onclick="saveData()">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è</button>
  <button onclick="toggleDebug()">üêû –ü–æ–∫–∞–∑–∞—Ç–∏/–ø—Ä–∏—Ö–æ–≤–∞—Ç–∏ JSON</button>
  <pre id="output" style="display: none;"></pre>

  <script>
  const endpoint = "https://script.google.com/macros/s/AKfycbwzAalnW-ldytFSAqY3DrheXN_oaKABVpW3fha5LZ8S6BGwklCoB__jA8GBgQmBKxKSOg/exec";


  const exerciseTemplates = {
    DAY1: ["–ö—ñ—à–∫–∞-–∫–æ—Ä–æ–≤–∞", "–°–∫—Ä—É—á—É–≤–∞–Ω–Ω—è –Ω–∞ –ø—Ä–µ—Å", "–ü—ñ–¥–π–æ–º —Ç–∞–∑–∞ (hip thrust)", "–ü—Ä–∏—Å—ñ–¥–∞–Ω–Ω—è –∑—ñ —à—Ç–∞–Ω–≥–æ—é (–Ω–∏–∑—å–∫–∏–π/—Å–µ—Ä–µ–¥–Ω—ñ–π —Ö–≤–∞—Ç)", "–†—É–º—É–Ω—Å—å–∫–∞ –º–µ—Ä—Ç–≤–∞ —Ç—è–≥–∞ –∑—ñ —à—Ç–∞–Ω–≥–æ—é", "–ë–æ–ª–≥–∞—Ä—Å—å–∫—ñ –ø—Ä–∏—Å—ñ–¥–∞–Ω–Ω—è –∑ –≥–∞–Ω—Ç–µ–ª—è–º–∏", "–ì—É–¥–º–æ—Ä–Ω—ñ–Ω–≥–∏ –∑—ñ —à—Ç–∞–Ω–≥–æ—é", "–ü–ª–∞–Ω–∫–∞ –Ω–∞ –ª—ñ–∫—Ç—è—Ö", "–í–∞–∫—É—É–º –∂–∏–≤–æ—Ç–∞ —Å—Ç–æ—è—á–∏"],
    DAY2: ["–ö—ñ—à–∫–∞-–∫–æ—Ä–æ–≤–∞", "–°–∫—Ä—É—á—É–≤–∞–Ω–Ω—è –Ω–∞ –ø—Ä–µ—Å", "–ü—ñ–¥–π–æ–º —Ç–∞–∑–∞ (hip thrust)", "–¢—è–≥–∞ —à—Ç–∞–Ω–≥–∏ –≤ –Ω–∞—Ö–∏–ª—ñ", "–¢—è–≥–∞ –≥–∞–Ω—Ç–µ–ª—ñ –≤ –Ω–∞—Ö–∏–ª—ñ", "–°—É–ø–µ—Ä–º–µ–Ω –Ω–∞ –ø—ñ–¥–ª–æ–∑—ñ", "Arnold‚Äôs Rear Delt Raise", "–ó–≥–∏–Ω–∞–Ω–Ω—è –Ω–∞ –±—ñ—Ü–µ–ø—Å (—à—Ç–∞–Ω–≥–∞)", "–ú–æ–ª–æ—Ç–æ–∫ (Hammer Curl)", "–ó–≤–æ—Ä–æ—Ç–Ω—ñ –≤—ñ–¥–∂–∏–º–∞–Ω–Ω—è –Ω–∞ –ª–∞–≤—Ü—ñ (—Ç—Ä–∏—Ü–µ–ø—Å)", "–ó–≥–∏–Ω–∞–Ω–Ω—è –∑–∞–ø‚Äô—è—Å—Ç—å –∑ –≥–∞–Ω—Ç–µ–ª—è–º–∏ –¥–ª—è –ø–µ—Ä–µ–¥–ø–ª—ñ—á"],
    DAY3: ["–ö—ñ—à–∫–∞-–∫–æ—Ä–æ–≤–∞", "–°–∫—Ä—É—á—É–≤–∞–Ω–Ω—è –Ω–∞ –ø—Ä–µ—Å", "–ü—ñ–¥–π–æ–º —Ç–∞–∑–∞ (hip thrust)", "–§—Ä–æ–Ω—Ç–∞–ª—å–Ω—ñ –ø—Ä–∏—Å—ñ–¥–∞–Ω–Ω—è –∑—ñ —à—Ç–∞–Ω–≥–æ—é", "–°—Ç–∞–Ω–æ–≤–∞ —Ç—è–≥–∞ —ñ–∑ —Å—É–º–æ-—Ä–æ–∑—Å—Ç–∞–Ω–æ–≤–∫–æ—é", "–í–∏–ø–∞–¥–∏ –Ω–∞–∑–∞–¥ –∑ –≥–∞–Ω—Ç–µ–ª—è–º–∏", "–ü—ñ–¥–π–æ–º–∏ –Ω–∞ –Ω–æ—Å–∫–∏ —Å—Ç–æ—è—á–∏ –∑—ñ —à—Ç–∞–Ω–≥–æ—é (—ñ–∫—Ä–∏)", "–ë—ñ—á–Ω–∞ –ø–ª–∞–Ω–∫–∞", "–ù–æ–∂–∏—Ü—ñ –ª–µ–∂–∞—á–∏"],
    DAY4: ["–ö—ñ—à–∫–∞-–∫–æ—Ä–æ–≤–∞", "–°–∫—Ä—É—á—É–≤–∞–Ω–Ω—è –Ω–∞ –ø—Ä–µ—Å", "–ü—ñ–¥–π–æ–º —Ç–∞–∑–∞ (hip thrust)", "–§–ª–æ—Ä-–ø—Ä–µ—Å –≥–∞–Ω—Ç–µ–ª—è–º–∏ (–ª–µ–∂–∞—á–∏ –Ω–∞ –ø—ñ–¥–ª–æ–∑—ñ)", "–†–æ–∑–≤–µ–¥–µ–Ω–Ω—è –≥–∞–Ω—Ç–µ–ª–µ–π –ª–µ–∂–∞—á–∏ –Ω–∞ –ª–∞–≤—Ü—ñ", "–ü—É–ª–ª–æ–≤–µ—Ä –∑ –≥–∞–Ω—Ç–µ–ª–ª—é –ª–µ–∂–∞—á–∏", "–§—Ä–∞–Ω—Ü—É–∑—Å—å–∫–∏–π –∂–∏–º", "–í—ñ–¥–∂–∏–º–∞–Ω–Ω—è –≤—ñ–¥ –ª–∞–≤–∫–∏ –≤—É–∑—å–∫–∏–º —Ö–≤–∞—Ç–æ–º", "–°—Ç–∞—Ç–∏—á–Ω–µ —É—Ç—Ä–∏–º–∞–Ω–Ω—è –≥–∞–Ω—Ç–µ–ª—ñ –ø–µ—Ä–µ–¥ –≥—Ä—É–¥—å–º–∏", "–ó–≥–∏–Ω–∞–Ω–Ω—è –≥–∞–Ω—Ç–µ–ª–µ–π –Ω–∞ –±—ñ—Ü–µ–ø—Å", "–ó–≥–∏–Ω–∞–Ω–Ω—è –∑–∞–ø‚Äô—è—Å—Ç—å –∑ –≥–∞–Ω—Ç–µ–ª—è–º–∏ –ø—Ä—è–º–∏–º —Ö–≤–∞—Ç–æ–º"]
  };

  let draggedIndex = null;

  function toggleDebug() {
    const out = document.getElementById("output");
    out.style.display = out.style.display === "none" ? "block" : "none";
  }

  function updateCustomExercises() {
    const day = document.getElementById("training-day").value;
    const customList = document.getElementById("custom-exercises").value.split(',').map(e => e.trim()).filter(e => e);
    if (customList.length > 0) {
      exerciseTemplates[day] = customList;
      localStorage.setItem(`exercises-${day}`, JSON.stringify(customList));
      renderExercises();
    }
  }

  function loadTemplatesFromStorage() {
    ["DAY1", "DAY2", "DAY3", "DAY4"].forEach(day => {
      const saved = localStorage.getItem(`exercises-${day}`);
      if (saved) {
        exerciseTemplates[day] = JSON.parse(saved);
      }
    });
  }

  function loadDayFromDate() {
    const date = document.getElementById("training-date").value;
    const possibleDays = ["DAY1", "DAY2", "DAY3", "DAY4"];
    for (let day of possibleDays) {
      if (localStorage.getItem(`training-${day}-${date}`)) {
        document.getElementById("training-day").value = day;
        renderExercises();
        return;
      }
    }
    renderExercises();
  }

  function dragStart(event) {
    draggedIndex = event.currentTarget.getAttribute("data-index");
  }

  function drop(event) {
    event.preventDefault();
    const targetIndex = event.currentTarget.getAttribute("data-index");
    const day = document.getElementById("training-day").value;

    const list = [...exerciseTemplates[day]];
    const [moved] = list.splice(draggedIndex, 1);
    list.splice(targetIndex, 0, moved);

    exerciseTemplates[day] = list;
    localStorage.setItem(`exercises-${day}`, JSON.stringify(list));
    renderExercises();
  }

  function renderExercises() {
    const day = document.getElementById("training-day").value;
    const date = document.getElementById("training-date").value || new Date().toLocaleDateString();
    const container = document.getElementById("exercises");
    container.innerHTML = "";

    const saved = localStorage.getItem(`training-${day}-${date}`);
    let exercisesList = [];
    try {
      const parsed = saved ? JSON.parse(saved) : null;
      if (parsed && Array.isArray(parsed.exercises) && parsed.exercises.every(e => e?.name)) {
        exercisesList = parsed.exercises.map(e => e.name);
      } else {
        const fallback = localStorage.getItem(`exercises-${day}`);
        exercisesList = fallback ? JSON.parse(fallback) : exerciseTemplates[day];
      }
    } catch (err) {
      exercisesList = exerciseTemplates[day];
    }

    exerciseTemplates[day] = exercisesList;
    document.getElementById("custom-exercises").value = exercisesList.join(", ");

    exercisesList.forEach((exercise, index) => {
      const block = document.createElement("div");
      block.className = "exercise-block";
      block.setAttribute("draggable", true);
      block.setAttribute("data-index", index);
      block.ondragstart = dragStart;
      block.ondrop = drop;

      let setsHTML = "";
      for (let s = 1; s <= 4; s++) {
        setsHTML += `
          <div class="set-row">
            <label>–ü—ñ–¥—Ö—ñ–¥ ${s}:</label>
            <input type="number" id="weight-${index}-${s}" placeholder="–í–∞–≥–∞" />
            <input type="number" id="reps-${index}-${s}" placeholder="–ü–æ–≤—Ç–æ—Ä–∏" />
            <div class="intensity-buttons">
              <button class="green" onclick="mark('${index}-${s}', 'üü¢')"></button>
              <button class="orange" onclick="mark('${index}-${s}', 'üü°')"></button>
              <button class="red" onclick="mark('${index}-${s}', 'üî¥')"></button>
              <span id="intensity-${index}-${s}" style="margin-left:10px;"></span>
            </div>
          </div>`;
      }

      block.innerHTML = `
        <div class="label">${exercise}</div>
        ${setsHTML}
        <label>–ü—Ä–∏–º—ñ—Ç–∫–∞:</label><textarea id="note-${index}"></textarea>
      `;
      container.appendChild(block);
    });

    loadData();
  }

  function mark(id, symbol) {
    document.getElementById(`intensity-${id}`).textContent = symbol;
  }

  function saveData() {
    const day = document.getElementById("training-day").value;
    const date = document.getElementById("training-date").value || new Date().toLocaleDateString();
    const result = { day, date, exercises: [] };

    exerciseTemplates[day].forEach((exercise, i) => {
      const sets = [];
      for (let s = 1; s <= 4; s++) {
        sets.push({
          weight: document.getElementById(`weight-${i}-${s}`).value,
          reps: document.getElementById(`reps-${i}-${s}`).value,
          intensity: document.getElementById(`intensity-${i}-${s}`).textContent
        });
      }
      result.exercises.push({
        name: exercise,
        sets: sets,
        note: document.getElementById(`note-${i}`).value
      });
    });

    localStorage.setItem(`training-${day}-${date}`, JSON.stringify(result));
    document.getElementById("output").textContent = JSON.stringify(result, null, 2);

    fetch(endpoint, {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(result)
    })
    .then(res => res.text())
    .then(msg => console.log("–í—ñ–¥–ø–æ–≤—ñ–¥—å –≤—ñ–¥ Google Sheets:", msg))
    .catch(err => console.error("–ü–æ–º–∏–ª–∫–∞ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è:", err));
  }

  function loadData() {
    const day = document.getElementById("training-day").value;
    const date = document.getElementById("training-date").value || new Date().toLocaleDateString();
    const saved = localStorage.getItem(`training-${day}-${date}`);
    if (!saved) return;

    const data = JSON.parse(saved);
    data.exercises.forEach((exercise, i) => {
      exercise.sets.forEach((set, s) => {
        document.getElementById(`weight-${i}-${s + 1}`).value = set.weight;
        document.getElementById(`reps-${i}-${s + 1}`).value = set.reps;
        document.getElementById(`intensity-${i}-${s + 1}`).textContent = set.intensity;
      });
      document.getElementById(`note-${i}`).value = exercise.note;
    });
    document.getElementById("output").textContent = JSON.stringify(data, null, 2);
  }

  loadTemplatesFromStorage();
  renderExercises();
</script>

</body>
</html>
